---
title: "Fiji FRL Report"
date: "`r format(Sys.time(), '%d %B, %Y')`"
header-includes: \usepackage{caption}
params:
  file_format: html
always_allow_html: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE,
                      message=FALSE, warning=FALSE)

library(rlang)
library(dplyr)
library(kableExtra)
library(FijiNFMSCalculations)
if (!exists("fileFormat")) fileFormat <- params$file_format
getOption("max.print")
```

\captionsetup[table]{labelformat=empty}

# Error Matrix
```{r echo = FALSE}
opts <- options(knitr.kable.NA = "")
t <- round(AdjustedAreas$errorMatrix, 5)
t <- rbind(t,totals=colSums(t))
t <- cbind(t,totals=rowSums(t))
t[t == 0] <- NA
t %>%
  kable(fileFormat,
    caption = "Adjusted Areas",
    digits = 5, format.args = list(scientific = FALSE)
  ) %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )
```


# Error Proportions
```{r echo = FALSE}
opts <- options(knitr.kable.NA = "")
t <- round(AdjustedAreas$errorProportions, 5)
t <- rbind(t,totals=colSums(t))
t <- cbind(t,totals=rowSums(t))
t[t == 0] <- NA
t %>%
  kable(fileFormat,
    caption = "Adjusted Areas",
    digits = 5, format.args = list(scientific = FALSE)
  ) %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )
```

# Adjusted Areas - 90% Confidence Interval
```{r echo = FALSE}

t <- cbind(AdjustedAreas$rs_AA, 'halfwidth_%'=round(100*(AdjustedAreas$rs_AA$uci_area_ha - AdjustedAreas$rs_AA$lci_area_ha)/2/AdjustedAreas$rs_AA$aaboot_mean,1)) 
t %>%
  kable(fileFormat, caption = "Adjusted Areas") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )
```

```{r echo = FALSE}
t <- cbind(AdjustedAreas$rs_AA_annual_df, 'halfwidth_%'=round(100*(AdjustedAreas$rs_AA_annual_df$uci_area_ha - AdjustedAreas$rs_AA_annual_df$lci_area_ha)/2/AdjustedAreas$rs_AA_annual_df$aaboot_mean,1)) 
t %>%
  kable(fileFormat, caption = "Adjusted Areas Annual Deforestation") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )
```
```{r echo = FALSE}
t <- cbind(AdjustedAreas$rs_AA_annual_ar, 'halfwidth_%'=round(100*(AdjustedAreas$rs_AA_annual_ar$uci_area_ha - AdjustedAreas$rs_AA_annual_ar$lci_area_ha)/2/AdjustedAreas$rs_AA_annual_ar$aaboot_mean,1)) 
t %>% 
  kable(fileFormat, caption = "Adjusted Areas Annual Afforestation") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )
```

# Activity Data

## AF area
```{r echo = FALSE}
print(AdjustedAreas$ARareas)
```
## DF area
```{r echo = FALSE}
print(AdjustedAreas$areaLoss)
```

# Growth Tables
Note: The growth projection only allows for 6 months in the first year (0.5) of planting.

## Afforestation
```{r echo = FALSE}


print(FRLAfforestation$ar_aa_area)

t <- FRLAfforestation$rs_ec_ar_cstock 
t %>% 
  kable(fileFormat, caption = "Growth Annual Afforestation") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )

```
## Native Forest Regrowth
```{r echo = FALSE}

print(FRLFelling$fd_lg_area)
print(mean(FRLFelling$fd_lg_area))

t <- FRLFelling$rs_ec_lnf_cstock
t %>% 
  kable(fileFormat, caption = "Growth Native Forest regrowth") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )

```
## Hardwood Plantations
```{r echo = FALSE}

print(FRLHardwoodPlantations$hw_p_area)
print(mean(FRLHardwoodPlantations$hw_p_area))
 
t <- FRLHardwoodPlantations$rs_ec_hw_cstock 
t %>% 
  kable(fileFormat, caption = "Growth Hardwood Plantations") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )



```
## Softwood Plantations
```{r echo = FALSE}

print(FRLSoftwoodPlantations$sw_p_area)
print(mean(FRLSoftwoodPlantations$sw_p_area))


t <- FRLSoftwoodPlantations$rs_ec_sw_cstock
t %>% 
  kable(fileFormat, caption = "Growth Softwood Plantations") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )

```


# FRL Results Table
```{r echo = FALSE}
options(max.print=1000000)
print(FRLTable$frltab)
```


# FRL Monitoring Report Input Data

## Overall FRL
```{r echo = FALSE}
options(max.print=1000000)


t <- ErpaYearlyFRL$erpa_yearly$yearly
t %>% 
  kable(fileFormat, caption = "Monitoring Period FRL values") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )


```
## Uncertainty FRL - LCI
```{r echo = FALSE}
options(max.print=1000000)


t <- ErpaYearlyFRL$erpa_yearly$uc_yearly$lci
t %>% 
  kable(fileFormat, caption = "Monitoring Period FRL LCI") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )


```
## Uncertainty FRL - UCI
```{r echo = FALSE}
options(max.print=1000000)

t <- ErpaYearlyFRL$erpa_yearly$uc_yearly$uci
t %>% 
  kable(fileFormat, caption = "Monitoring Period FRL UCI") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )


```
## Monitoring Period 2019 to 2020
```{r echo = FALSE}
options(max.print=1000000)

t <- ErpaYearlyFRL$erpa_yearly$mp_frl
t %>% 
  kable(fileFormat, caption = "Monitoring Period FRL 2019 to 2020") %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )


```

## FRL Params
```{r echo = FALSE}
t <- FRLParams

data.frame(value = unlist(t)) %>% 
  kable(fileFormat, caption = "FRL Parameters", 
        format.args = list(big.mark = ",",digits=2, nsmall = 0,scientific = FALSE)) %>%
  kable_styling(
    latex_options = c("hold_position", "scale_down")
  )

```


## FRL Monitored Values
```{r echo = FALSE}

MVTable <- data.frame(
  symbol = character(),
  name = character(),
  stringsAsFactors=FALSE)

MVTable <- rbind(MVTable,list(
  symbol = "\\begin{align} X_{X,t} \\end{align}",
  name  = "DeforAreaLow"
), stringsAsFactors=FALSE)  
    

#"AdjustedAreas"
#"bioburn_ghgs"
#"dnf_area"
#"EmissionFactors" 
#"hw_ahp"         
#"hw_species"
#"hwsw_volharv"
#"lnf_area"
#"lnf_volume"
#"nfi_ai_esf_srtm"
#"nfi_cid"
#"nfi_r2"
#"nfi_r3"
#"nfi_species"
#"nfi_spid"       
#"nfi_strata"
#"psp_trees"
#"pthd"
#"sw_barea"
#"sw_hvol_parea"  
```

